{% extends 'core/base.html' %}
{% load static %}
{% block content %}

{% include 'core/dashboard-navbar.html'%}

<!--CHARTJS-->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
{{resultados|json_script:'resultados'}}
<canvas id="origens_das_sessoes"></canvas>

<!--MOBILE-->
{% if mobile %}
<div class="d-flex justify-content-center">
  <iframe width="100%" height="2850"
    src="https://datastudio.google.com/embed/reporting/90dc4789-35e5-4eb8-886f-695bd2591690/page/S33B" frameborder="0"
    style="border:0" allowfullscreen></iframe>
</div>
{% else %}
<!--DESKTOP-->
<div class="container">
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
    <h1 class="h2">{{card.primeiro_nome}} {{card.ultimo_nome}} nos últimos 30 dias</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
      <!-- <div class="btn-group me-2">
        <button type="button" class="btn btn-sm btn-outline-secondary">Compartilhar</button>
        <button type="button" class="btn btn-sm btn-outline-secondary">Exportar</button>
      </div>
      <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
          class="feather feather-calendar align-text-bottom" aria-hidden="true">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        Essa semana
      </button> -->
    </div>
  </div>

  <div class="row align-items-md-stretch my-4">

    <!--AQUISIÇÃO DE USUÁRIOS-->
    <div class="col-md-4">
      <div class="h-100 p-3 bg-light rounded-3">
        <h5 class="pb-4">Aquisição de usuários</h5>
        <div class="d-flex">
          <div class="col-6 text-center">
            <div class="align-items-center d-inline-flex flex-column flex-shrink-0 fs-4 justify-content-center">
              <span class="fs-6">Total de usuários</span>
              <span class="fs-1">{{total_de_usuarios}}</span>
            </div>
          </div>
          <div class="col-6 text-center">
            <div class="align-items-center d-inline-flex flex-column flex-shrink-0 fs-4 justify-content-center">
              <span class="fs-6">Usuários ativos</span>
              <span class="fs-1">{{usuarios_ativos}}</span>
            </div>
          </div>
        </div>
        <div class="d-flex">
          <div class="col-6 text-center">
            <div class="align-items-center d-inline-flex flex-column flex-shrink-0 fs-4 justify-content-center">
              <span class="fs-6">Novos usuários</span>
              <span class="fs-1">{{novos_usuarios}}</span>
            </div>
          </div>
          <div class="col-6 text-center">
            <div class="align-items-center d-inline-flex flex-column flex-shrink-0 fs-4 justify-content-center">
              <span class="fs-6">Tempo de interação</span>
              <span class="fs-1">{{tempo_de_interacao|floatformat:2}}s</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!--AQUISIÇÃO DE TRÁFEGO-->
    <div class="col-md-4">
      <div class="h-100 p-3 bg-light rounded-3">
        <h5 class="pb-4">Aquisição de tráfego</h5>
        <div class="d-flex">
          <div class="col-6 text-center">
            <div class="align-items-center d-inline-flex flex-column flex-shrink-0 fs-4 justify-content-center">
              <span class="fs-6">Visualizações</span>
              <span class="fs-1">{{visualizacoes}}</span>
            </div>
          </div>
          <div class="col-6 text-center">
            <div class="align-items-center d-inline-flex flex-column flex-shrink-0 fs-4 justify-content-center">
              <span class="fs-6">Sessões</span>
              <span class="fs-1">{{sessoes}}</span>
            </div>
          </div>
        </div>
        <div class="d-flex">
          <div class="col-6 text-center">
            <div class="align-items-center d-inline-flex flex-column flex-shrink-0 fs-4 justify-content-center">
              <span class="fs-6">Duração média da sessão</span>
              <span class="fs-1">{{duracao_media_sessao|floatformat:2}}s</span>
            </div>
          </div>
          <div class="col-6 text-center">
            <div class="align-items-center d-inline-flex flex-column flex-shrink-0 fs-4 justify-content-center">
              <span class="fs-6">Rejeição</span>
              <span class="fs-1">{{rejeicao}}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!--ORIGEM DE TRÁFEGO-->
    <div class="col-md-4">
      <div class="h-100 p-3 bg-light rounded-3">
        <h5 class="pb-4">Origem do tráfego</h5>
        <div class="d-flex">
          <div class="col-6 text-center">
            <div class="align-items-center d-inline-flex flex-column flex-shrink-0 fs-4 justify-content-center">
              <span class="fs-6">Origens</span>
              <span class="fs-1"></span>
            </div>
          </div>
          <div class="col-6 text-center">
            <div class="align-items-center d-inline-flex flex-column flex-shrink-0 fs-4 justify-content-center">
              <span class="fs-6">Usuários por origem</span>
              <span class="fs-1"></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--INFORMAÇÕES DEMOGRÁFICAS-->
  <div class="col-md-12">
    <div class="h-100 p-3 bg-light rounded-3">
      <h5>Informações demográficas</h5>
      <table class="table">
        <thead>
          <th>Usuários ativos</th>
          <th>Total usuários</th>
          <th>Novos usuários</th>
          <th>Sessões</th>
          <th>Sessão Média</th>
          <th>Sessões por usuário</th>
          <th>Engajamento</th>
          <th>Visualizações</th>
          <th>Visualizações por sessão</th>
          <th>Rejeição</th>
        </thead>
        <tbody>
          {% for row in data.rows %}

          {% for dimension in row.dimension_values %}
          <tr>{{dimension.value}}</tr>
          {% endfor %}

          {% for metric in row.metric_values %}
          <td>{{metric.value}}</td>
          {% endfor %}

          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  let resultados = JSON.parse(document.querySelector("#resultados").textContent);
  let chartStatus = Chart.getChart("origens_das_sessoes"); // <canvas> id

  if (chartStatus != undefined) {
    chartStatus.destroy();
  }

  let chartData = {
    labels: resultados.origens,
    datasets: [
      {
        axis: 'y',
        data: resultados.usuarios_por_origem,
        backgroundColor: [
          'rgba(86, 122, 177)',
        ],
        borderColor: [
          'rgba(86, 122, 177)',
        ],
        borderWidth: 1
      },
    ]
  }
  let chartOptions = {
    scales: {
      xAxis: {
        beginAtZero: true,
        grid: {
          display: false,
        }
      },
      yAxis: {
        beginAtZero: true,
        ticks: {
          min: 0,
          max: 100,
          stepSize: 10,
        }
      }
    },
    plugins: {
      legend: {
        labels: {
          boxWidth: 5,
          font: {
            size: 20,
          }
        }
      }
    },
    options: {
      indexAxis: 'y',
    }
  }
  
  let resultadosctx = document.getElementById('origens_das_sessoes').getContext('2d');
  let resultadosChart = new Chart(resultadosctx, { type: 'bar', data: chartData, options: chartOptions });
</script>

{% endif %}
{% endblock %}